## MySQL深入学习
### MySQL的引擎
* MyISAM 
* InoDB
* Mememry
* DBD


### 什么是事务
* 事务是指程序或数据库中单个处理逻辑的一系列操作（语句），要么完全地执行，要么完全地不执行，要么都成功，要么都失败的一种机制。它是保证数据一致性的重要工具。
* 事务具有四个特性：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）和持续性（Durability）。这四个特性也简称ACID性。
 * 原子性：要不全部成功，要不全部撤销
 * 隔离性：事务之间相互独立，互不干扰
 * 一致性：数据库正确地改变状态后，数据库的一致性约束没有被破坏
 * 持久性：事务的提交结果，将持久保存在数据库中
* MySQL的事务一般是通过锁来实现，MySQL的锁有多种，主要可以分为表锁、页锁及行锁，各种锁机制将在下文中详细描述。

### 并发事务时出现的各种情况
* 第一类丢失更新：两个事务都同时更新一条记录，但是第二个事务却中途失败退出，导致对数据的两个修改都失效了。
* 脏读：脏读就是指当一个事务正在访问数据，并且对数据进行了修改，而这种修改还没有提交到数据库中，这时，另外一个事务也访问这个数据，然后使用了这个数据。

### 各种锁的概念及应用描述

#### 表锁
 
 MySQL的表锁,一般是在MyISAM引擎中实现，分为：表共享读锁（Table Read Lock）和表独占写锁（Table Write Lock）两种：
 
 * 表共享读锁时，允许其它进程读数据，不允许写操作，操作语句为： lock tables xxxx read local ；xxxxx;  unlock tables; 
 * 表独占写锁时，不允许其它进程读和写操作, 操作语句为： lock tables xxxx write ；xxxxx;  unlock tables; 
 

#### 页锁
介于行锁与表锁之间，不常用，且是DBD引擎才支持，会有死锁。

#### 行锁
  InnoDB才支持的锁机制，不过行锁必须通过索引才实现，即通过索引找到具体的记录才能实现行锁，否则，InnoDB将使用表锁！在实际应用中，要特别注意，不然会导致大量的锁冲突，从而影响并发，甚至导致死锁。

#### 悲观锁和乐观锁
* 悲观锁(Pessimistic Lock), 是一种保守的锁机制，它悲观地认为每次去拿数据时别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。传统关系型数据库应用的基本上是悲观锁，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。

  在悲观锁的情况下，为了保证事务的隔离性，就需要一致性锁定读。读取数据时给加锁，其它事务无法修改这些数据。修改删除数据时也要加锁，其它事务无法读取这些数据。

* 乐观锁(Optimistic Lock), 就是很乐观的锁机制，它每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量，像数据库如果提供类似于write_condition机制的其实都是提供的乐观锁。

   乐观锁一般是在程序代码中实现，而想要在数据库中实现乐观锁一般需要在表中增加版本号的字段，每次更新前，先判断

#### 其它角度的锁机制描述：

* 共享锁（读锁）：允许一个事务去读一行，阻止其他事务获得相同数据集的排他锁。
* 排他锁（写锁）：允许获得排他锁的事务更新数据，阻止其他事务取得相同数据集的共享读锁和排他写锁。
* 意向共享锁（IS）：事务打算给数据行加行共享锁，事务在给一个数据行加共享锁前必须先取得该表的IS锁。
* 意向排他锁（IX）：事务打算给数据行加行排他锁，事务在给一个数据行加排他锁前必须先取得该表的IX锁。

#### 死锁



### 索引及性能优化
* 索引分类：
  * 聚焦索引（主键索引）
  * 普通索引
  * 唯一索引
  * 全文索引（FUNLLTEXT INDEX）, 建议使用Sphinx等搜索引擎来进行替代，而不是真正使用全文索引。
  
* 如何进行定位SQL语句的性能
  * 通过工具提前分析SQL语句，如通过explain分析，或通过开源工具：SQLAdvisor分析SQL语句，进行性能优化
  * 通过慢查询定位有问题的SQL语句；

### MySQL执行计划
用于分析SQL语句的执行情况及索引的使用情况，从而实现SQL语句的索引优化。


### 事务及应用场景、问题及解决方案
1. **用户注册时**，需要保证用户账号的唯一性，及并发注册时不能重复注册
2. 用户账号金额变动时的锁机制处理；
3. 


### 数据库设计技巧

* 碰到的一个问题，用户表登陆信息表与基本信息表手机号存在冗余，如有变更，是应该同步修改的，但由于程序没有做好一致性控制，导致出现手机号不一致的情况，故引导这样的思考。
* 数据库可以做冗余设计，减少联表查询；
* 通过定时任务对于冗余字段的数据进行同步；
* 冗余字段的更新等级：
  * 立即同步更新，代码中立即更新
  * 异步同步更新，通过异步任务延时更新
  * 定时任务更新

### MySQL深入阅读教材

*  MySQL官方手册：[中文](http://doc.mysql.cn/mysql5/refman-5.1-zh.html-chapter/)
* 《高性能MySQL》：电子书 （需深入学习）
* 《MySQL性能调优与架构设计》：当当电子书
* MySQL网易内部电子书：泛泛而读
* 参考博文：
 * http://www.cnblogs.com/chenqionghe/p/4845693.html
 * [mysql 隔离级别与锁 ](http://blog.csdn.net/pingnanlee/article/details/41824389) 


