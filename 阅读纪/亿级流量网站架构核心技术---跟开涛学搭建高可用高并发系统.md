# 亿级流量网站架构核心技术---跟开涛学搭建高可用高并发系统

## 第1部分 概述
## 第1章 交易型系统设计原则
#### 高并发原则
* 无状态
* 系统拆分
* 服务化
* 消息队列
* 数据异构
* 缓存
* 并发化


#### 高可用原则
* 降级
* 限流
* 切流量
* 可回滚
* 防单点（我写的）
* 高安全 -- 系统不安全，很容易被攻破
* 高并发 -- 系统要能够支撑一定的流量冲击
* 测试与预算 提前做好测试

#### 业务设计原则
* 防重设计
* 幂等设计
* 流程可定义
* 状态与状态机
* 后台系统操作可反馈
* 后台系统审批化
* 文档和注释
* 备份


## 第2部分
### 第2章 负载均衡与反向代理

**网络链接中，各层可实现的负载均衡方式**

* DNS层：实现GSLB（全局负载均衡）
* 接入层：LVS/F5 （待完善）
* Nginx层：一般用于七层负载均衡，

**负载均衡关注的重点**

* 上游服务器配置
* 负载均衡算法
* 失败重试机制
* 服务器心跳检测： TCP/HTTP心跳检测，也可使用Nginx插件 openresty实现

##### 负载均衡算法
##### 2.8 HTTP动态负载均衡

通过Consul实现

* Consul + Consul-template
* Consul + OpenResty

##### 2.9Nginx四层负载均衡

1.9版本后支持


### 第3章 隔离术

##### 3.1 线程隔离
针对多线程语言，通过线程池隔离实现，发Tomcat，Hystrix等按服务等级划分线程池

##### 3.2 进程隔离

##### 3.3 群集隔离
##### 3.4 机房隔离
##### 3.5 读写隔离
##### 3.6 动静隔离
##### 3.7 爬虫隔离
##### 3.8 热点隔离
秒杀服务单独拿出来部署，甚至可以部署在另一个机房，以实现物理上的隔离
##### 3.9 资源隔离
##### 3.10 使用Hystrix实现隔离
##### 3.11 基于Servlet 3实现请求隔离

### 第4章 限流术
在通过缓存及降级等措施对系统进行保护之后，如果还有一些必要的动态系统必须提供高并发服务时，当系统支撑能力不足时，则需要通过限流来解决问题了。

限流的方式有：

* 限制总并发数（数据库连接池、线程池）；
* 限制瞬时并发数（Nginx的limit_conn，限制瞬时并发）；
* 限制时间范围内的平均速率（Guava的RateLimiter,Nginx的limit_req)
* 网络连接数、网络流量、CPU或内存负载来进行限流；

##### 4.1 限流算法



秒杀系统，下单后才减库存
或库存锁定1分钟，不然就释放。
